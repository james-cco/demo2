name: ğŸ”„ Auto Sync Upstream

on:
  schedule:
    - cron: '0 4 * * *'  # æ¯å¤©å°ç£æ™‚é–“ä¸­åˆ 12 é»ï¼ˆUTC+8ï¼‰
  workflow_dispatch:     # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  sync:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:
      - name: ğŸ§© è¨­å®š Git ç’°å¢ƒ
        run: |
          git config --global user.email "james@cco.com.tw"
          git config --global user.name "james-cco"

      - name: â¬‡ï¸ Clone å€‰åº«
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: ğŸš€ æ·»åŠ  upstream ä¸¦åŒæ­¥
        run: |
          git remote add upstream https://github.com/james-cco/demo2.git
          git fetch upstream
          git checkout main || git checkout -b main
          git merge upstream/main --no-edit || echo "âœ… æ²’æœ‰ä¸Šæ¸¸æ›´æ–°"
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git main
